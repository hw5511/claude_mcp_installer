[1mdiff --git a/mcp_shop/notion_mcp_for_py/notion_mcp.py b/mcp_shop/notion_mcp_for_py/notion_mcp.py[m
[1mindex 7786219..38e2b87 100644[m
[1m--- a/mcp_shop/notion_mcp_for_py/notion_mcp.py[m
[1m+++ b/mcp_shop/notion_mcp_for_py/notion_mcp.py[m
[36m@@ -5,6 +5,7 @@[m [mimport os[m
 import sys[m
 import json[m
 import logging[m
[32m+[m[32mimport re[m
 from typing import Dict, List, Optional, Any, Union[m
 from datetime import datetime[m
 [m
[36m@@ -47,6 +48,12 @@[m [mclass NotionHelper:[m
         except Exception as e:[m
             logger.error(f"Notion í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨: {e}")[m
             sys.exit(1)[m
[32m+[m[41m            [m
[32m+[m[32m        # í˜ì´ì§€ ì •ë³´ ìºì‹œ[m
[32m+[m[32m        self.page_cache = {}[m
[32m+[m[41m        [m
[32m+[m[32m        # ì—…ë¡œë“œ ì „ ë‚´ìš© ìºì‹œ[m
[32m+[m[32m        self.upload_cache = {}[m
 [m
     def _format_notion_url(self, page_id: str) -> str:[m
         """Notion í˜ì´ì§€ IDë¥¼ URL í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤."""[m
[36m@@ -72,6 +79,290 @@[m [mclass NotionHelper:[m
         [m
         # ì´ë¯¸ IDì¸ ê²½ìš°[m
         return url_or_id.replace("-", "")[m
[32m+[m[41m        [m
[32m+[m[32m    def get_page_structure(self, page_id):[m
[32m+[m[32m        """í˜ì´ì§€ êµ¬ì¡°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤."""[m
[32m+[m[32m        try:[m
[32m+[m[32m            children = self.client.blocks.children.list(block_id=page_id)[m
[32m+[m[32m            pages = [][m
[32m+[m[41m            [m
[32m+[m[32m            for block in children.get('results', []):[m
[32m+[m[32m                if block['type'] == 'child_page':[m
[32m+[m[32m                    page_info = {[m
[32m+[m[32m                        'id': block['id'],[m
[32m+[m[32m                        'title': block['child_page']['title'],[m
[32m+[m[32m                        'has_children': False[m
[32m+[m[32m                    }[m
[32m+[m[41m                    [m
[32m+[m[32m                    # í•˜ìœ„ í˜ì´ì§€ í™•ì¸[m
[32m+[m[32m                    sub_pages = self.client.blocks.children.list(block_id=block['id'])[m
[32m+[m[32m                    if sub_pages['results']:[m
[32m+[m[32m                        page_info['has_children'] = True[m
[32m+[m[41m                    [m
[32m+[m[32m                    pages.append(page_info)[m
[32m+[m[32m                    self.page_cache[block['id']] = page_info[m
[32m+[m[41m                    [m
[32m+[m[32m            return pages[m
[32m+[m[41m            [m
[32m+[m[32m        except Exception as e:[m
[32m+[m[32m            logger.error(f"í˜ì´ì§€ êµ¬ì¡° ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}")[m
[32m+[m[32m            return [][m
[32m+[m[41m            [m
[32m+[m[32m    def verify_upload(self, page_id, original_blocks):[m
[32m+[m[32m        """ì—…ë¡œë“œëœ ë‚´ìš©ì„ ê²€ì¦í•©ë‹ˆë‹¤."""[m
[32m+[m[32m        try:[m
[32m+[m[32m            current_blocks = self.client.blocks.children.list(block_id=page_id).get("results", [])[m
[32m+[m[41m            [m
[32m+[m[32m            if len(original_blocks) != len(current_blocks):[m
[32m+[m[32m                logger.warning(f"âš ï¸ ë¸”ë¡ ìˆ˜ê°€ ë‹¤ë¦…ë‹ˆë‹¤: ì›ë³¸ {len(original_blocks)}ê°œ, í˜„ì¬ {len(current_blocks)}ê°œ")[m
[32m+[m[41m                [m
[32m+[m[32m            # ë‚´ìš© ë¹„êµ[m
[32m+[m[32m            for i, orig_block in enumerate(original_blocks):[m
[32m+[m[32m                if i < len(current_blocks):[m
[32m+[m[32m                    curr_block = current_blocks[i][m
[32m+[m[41m                    [m
[32m+[m[32m                    # ë¸”ë¡ íƒ€ì… í™•ì¸[m
[32m+[m[32m                    if orig_block["type"] != curr_block["type"]:[m
[32m+[m[32m                        logger.warning(f"âš ï¸ ë¸”ë¡ {i+1}ì˜ íƒ€ì…ì´ ë‹¤ë¦…ë‹ˆë‹¤: ì›ë³¸ {orig_block['type']}, í˜„ì¬ {curr_block['type']}")[m
[32m+[m[32m                        continue[m
[32m+[m[41m                    [m
[32m+[m[32m                    # í…ìŠ¤íŠ¸ ì½˜í…ì¸  ë¹„êµ[m
[32m+[m[32m                    if orig_block["type"] in ["paragraph", "heading_1", "heading_2", "heading_3",[m[41m [m
[32m+[m[32m                                             "bulleted_list_item", "numbered_list_item", "to_do", "code"]:[m
[32m+[m[32m                        orig_text = self._get_text_from_block(orig_block)[m
[32m+[m[32m                        curr_text = self._get_text_from_block(curr_block)[m
[32m+[m[41m                        [m
[32m+[m[32m                        if orig_text.strip() != curr_text.strip():[m
[32m+[m[32m                            logger.warning(f"âš ï¸ ë¸”ë¡ {i+1}ì˜ ë‚´ìš©ì´ ë‹¤ë¦…ë‹ˆë‹¤:")[m
[32m+[m[32m                            logger.warning(f"  ì›ë³¸: {orig_text[:100]}...")[m
[32m+[m[32m                            logger.warning(f"  í˜„ì¬: {curr_text[:100]}...")[m
[32m+[m[32m                else:[m
[32m+[m[32m                    logger.warning(f"âŒ ë¸”ë¡ {i+1}ì´ í˜„ì¬ ë²„ì „ì—ì„œ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.")[m
[32m+[m[41m            [m
[32m+[m[32m            # ì¶”ê°€ ë¸”ë¡ í™•ì¸[m
[32m+[m[32m            if len(current_blocks) > len(original_blocks):[m
[32m+[m[32m                for i in range(len(original_blocks), len(current_blocks)):[m
[32m+[m[32m                    logger.warning(f"âŒ ë¸”ë¡ {i+1}ì´ ì›ë³¸ì— ì—†ëŠ” ì¶”ê°€ ë¸”ë¡ì…ë‹ˆë‹¤.")[m
[32m+[m[32m                    curr_text = self._get_text_from_block(current_blocks[i])[m
[32m+[m[32m                    logger.warning(f"  ë‚´ìš©: {curr_text[:100]}...")[m
[32m+[m[41m                    [m
[32m+[m[32m            return len(original_blocks) == len(current_blocks)[m
[32m+[m[41m                [m
[32m+[m[32m        except Exception as e:[m
[32m+[m[32m            logger.error(f"ì—…ë¡œë“œ ê²€ì¦ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}")[m
[32m+[m[32m            return False[m
[32m+[m[41m            [m
[32m+[m[32m    def _get_text_from_block(self, block):[m
[32m+[m[32m        """ë¸”ë¡ì—ì„œ í…ìŠ¤íŠ¸ ë‚´ìš©ì„ ì¶”ì¶œí•©ë‹ˆë‹¤."""[m
[32m+[m[32m        block_type = block["type"][m
[32m+[m[41m        [m
[32m+[m[32m        if block_type == "paragraph":[m
[32m+[m[32m            return ''.join([t.get('plain_text', '') for t in block['paragraph']['rich_text']])[m
[32m+[m[32m        elif block_type.startswith("heading_"):[m
[32m+[m[32m            return ''.join([t.get('plain_text', '') for t in block[block_type]['rich_text']])[m
[32m+[m[32m        elif block_type == "bulleted_list_item":[m
[32m+[m[32m            return ''.join([t.get('plain_text', '') for t in block['bulleted_list_item']['rich_text']])[m
[32m+[m[32m        elif block_type == "numbered_list_item":[m
[32m+[m[32m            return ''.join([t.get('plain_text', '') for t in block['numbered_list_item']['rich_text']])[m
[32m+[m[32m        elif block_type == "to_do":[m
[32m+[m[32m            return ''.join([t.get('plain_text', '') for t in block['to_do']['rich_text']])[m
[32m+[m[32m        elif block_type == "code":[m
[32m+[m[32m            return ''.join([t.get('plain_text', '') for t in block['code']['rich_text']])[m
[32m+[m[32m        else:[m
[32m+[m[32m            return ""[m
[32m+[m[41m            [m
[32m+[m[32m    def store_original_content(self, page_id, content):[m
[32m+[m[32m        """ì—…ë¡œë“œ ì „ ë‚´ìš©ì„ ìºì‹œì— ì €ì¥í•©ë‹ˆë‹¤."""[m
[32m+[m[32m        self.upload_cache[page_id] = content[m
[32m+[m[41m            [m
[32m+[m[32m    def markdown_to_blocks(self, md_content):[m
[32m+[m[32m        """ë§ˆí¬ë‹¤ìš´ ë‚´ìš©ì„ ë…¸ì…˜ ë¸”ë¡ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤."""[m
[32m+[m[32m        blocks = [][m
[32m+[m[32m        current_block = {"type": "paragraph", "content": ""}[m
[32m+[m[32m        lines = md_content.split('\n')[m
[32m+[m[32m        i = 0[m
[32m+[m[41m        [m
[32m+[m[32m        while i < len(lines):[m
[32m+[m[32m            line = lines[i].strip()[m
[32m+[m[32m            i += 1